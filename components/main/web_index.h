/* Generated by embed_web.py - DO NOT EDIT */
#ifndef WEB_INDEX_H
#define WEB_INDEX_H

#include <stddef.h>

const char index_html[] =
"<!doctype html>\n"
"<html lang=\"en\">\n"
"<head>\n"
"  <meta charset=\"utf-8\">\n"
"  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n"
"  <title>AS3935 Config</title>\n"
"  <style>\n"
"    :root{--primary:#0d47a1;--muted:#6b7280;--bg:#f6f8fb;--card:#fff;--success:#388e3c;--warning:#f57c00;--error:#d32f2f}\n"
"    *{box-sizing:border-box}\n"
"    body{font-family:Inter,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#111}\n"
"    header{background:linear-gradient(90deg,var(--primary),#1565c0);color:#fff;padding:16px;margin-bottom:16px}\n"
"    header h1{font-size:22px;margin:0;display:flex;align-items:center;gap:8px}\n"
"    main{max-width:1200px;margin:0 auto;padding:0 12px 24px}\n"
"    section.card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,0.05)}\n"
"    section.card h3{margin:0 0 16px 0;padding-bottom:8px;border-bottom:2px solid #f0f0f0}\n"
"    .label{font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:500}\n"
"    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9;font-family:inherit;font-size:14px}\n"
"    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(13,71,161,0.1)}\n"
"    button{background:var(--primary);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:500;font-size:14px}\n"
"    button:hover{background:#0a3a8a}\n"
"    button:disabled{opacity:0.5;cursor:not-allowed}\n"
"    button.ghost{background:transparent;color:var(--primary);border:1px solid rgba(13,71,161,0.2)}\n"
"    button.ghost:hover{background:rgba(13,71,161,0.05)}\n"
"    button.btn-active{background:var(--primary);color:#fff;border:1px solid var(--primary)}\n"
"    button.btn-active:hover{background:#0a3a8a}\n"
"    button.btn-secondary{background:transparent;color:#999;border:1px solid #ddd}\n"
"    button.btn-secondary:hover{background:#f5f5f5}\n"
"    button.success{background:var(--success)}button.success:hover{background:#2e7d32}\n"
"    button.danger{background:var(--error)}button.danger:hover{background:#b71c1c}\n"
"    .grid{display:grid;gap:12px}\n"
"    @media(min-width:768px){.grid{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(3,1fr)}.grid.full{grid-template-columns:1fr}}\n"
"    @media(max-width:767px){.grid,.grid-3,.grid.full{grid-template-columns:1fr!important}}\n"
"    .field-row{display:flex;gap:8px;align-items:flex-end}\n"
"    .field-row>*{flex:1;display:flex;flex-direction:column}\n"
"    .toggle-btn{background:transparent;color:var(--primary);border:1px solid rgba(13,71,161,0.2);padding:8px;width:44px;flex:0 0 44px!important}\n"
"    .status-box{padding:12px;border-radius:8px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center}\n"
"    .status-box.connected{background:#e8f5e9;border-left:4px solid var(--success)}\n"
"    .status-box.connecting{background:#fff3e0;border-left:4px solid var(--warning)}\n"
"    .status-box.disconnected{background:#ffebee;border-left:4px solid var(--error)}\n"
"    .status-text{font-weight:bold}\n"
"    .status-text.connected{color:var(--success)}\n"
"    .status-text.connecting{color:var(--warning)}\n"
"    .status-text.disconnected{color:var(--error)}\n"
"    .spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(0,0,0,0.1);border-top:2px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite}\n"
"    @keyframes spin{to{transform:rotate(360deg)}}\n"
"    .button-group{display:flex;gap:8px;flex-wrap:wrap}\n"
"    .info{background:#e3f2fd;border-left:4px solid var(--primary);padding:12px;border-radius:6px;font-size:13px;color:#0d47a1;margin-bottom:12px}\n"
"  </style>\n"
"</head>\n"
"<body>\n"
"<header>\n"
"  <h1>‚ö° AS3935 Lightning Monitor</h1>\n"
"</header>\n"
"<main>\n"
"  <section class=\"card\">\n"
"    <h3>üì° Wi-Fi Configuration</h3>\n"
"    <div class=\"info\">Select from available networks or enter a hidden SSID manually. Settings are saved automatically when you click \"Connect Now\".</div>\n"
"    <div class=\"grid grid-3\">\n"
"      <div>\n"
"        <div class=\"label\">Network (SSID)</div>\n"
"        <div style=\"display:flex;gap:8px;align-items:center\">\n"
"          <select id=\"wifi_ssid_select\" style=\"flex:1\">\n"
"            <option value=\"\">Loading networks...</option>\n"
"          </select>\n"
"          <button id=\"wifi_scan\" class=\"ghost\" style=\"flex:0;padding:10px;width:44px\" title=\"Refresh networks\">üîÑ</button>\n"
"        </div>\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">or enter manually:</div>\n"
"        <input id=\"wifi_ssid_manual\" type=\"text\" placeholder=\"Hidden SSID (optional)\" style=\"margin-top:4px\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Password</div>\n"
"        <form style=\"display:contents\">\n"
"          <div style=\"display:flex;gap:8px;align-items:center\">\n"
"            <input id=\"wifi_password\" type=\"password\" placeholder=\"Password\" style=\"flex:1\" autocomplete=\"off\">\n"
"            <button id=\"wifi_pwd_toggle\" type=\"button\" class=\"toggle-btn\" title=\"Show/Hide\">üëÅ</button>\n"
"            <span id=\"wifi_pwd_badge\" style=\"font-size:12px;color:var(--muted);min-width:40px;text-align:right\"></span>\n"
"          </div>\n"
"        </form>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Current SSID</div>\n"
"        <div style=\"padding:10px;background:#f5f5f5;border-radius:8px;font-size:14px;display:flex;align-items:center;gap:8px\">\n"
"          <span id=\"wifi_current_ssid\">Not connected</span>\n"
"          <span id=\"wifi_signal\" style=\"min-width:30px;text-align:right;color:var(--muted)\"></span>\n"
"        </div>\n"
"      </div>\n"
"    </div>\n"
"    <div class=\"button-group\" style=\"margin-top:16px\">\n"
"      <button id=\"wifi_save\" class=\"ghost\">Save Settings</button>\n"
"      <button id=\"wifi_connect\" class=\"success\" style=\"flex:1\">‚Üó Connect Now</button>\n"
"    </div>\n"
"    <div id=\"wifi_status\" style=\"margin-top:12px;padding:8px;font-size:13px;color:var(--muted)\"></div>\n"
"  </section>\n"
"\n"
"  <section class=\"card\">\n"
"    <h3>üîå MQTT Broker Configuration</h3>\n"
"    <div id=\"mqtt_status_box\" class=\"status-box disconnected\">\n"
"      <div>\n"
"        <div style=\"font-size:12px;color:#666;margin-bottom:4px\">Connection Status</div>\n"
"        <div class=\"status-text disconnected\" id=\"mqtt_status_display\">Disconnected</div>\n"
"      </div>\n"
"      <button id=\"mqtt_refresh\" class=\"ghost\" style=\"width:auto\">Refresh</button>\n"
"    </div>\n"
"    <div class=\"grid grid-3\">\n"
"      <div>\n"
"        <div class=\"label\">Protocol</div>\n"
"        <select id=\"mqtt_protocol\">\n"
"          <option value=\"mqtt\">mqtt://</option>\n"
"          <option value=\"mqtts\">mqtts:// (TLS)</option>\n"
"        </select>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Hostname or IP</div>\n"
"        <input id=\"mqtt_host\" type=\"text\" placeholder=\"192.168.1.97 or broker.example.com\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Port</div>\n"
"        <input id=\"mqtt_port\" type=\"number\" placeholder=\"1883\" min=\"1\" max=\"65535\" value=\"1883\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Lightning Topic</div>\n"
"        <input id=\"mqtt_topic\" type=\"text\" placeholder=\"as3935/lightning\" value=\"as3935/lightning\">\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">Topic for lightning strike events</div>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Availability Topic</div>\n"
"        <input id=\"mqtt_availability_topic\" type=\"text\" placeholder=\"as3935/availability\" value=\"as3935/availability\">\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">Topic for online/offline status</div>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Username</div>\n"
"        <input id=\"mqtt_username\" type=\"text\" placeholder=\"(optional)\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">Password</div>\n"
"        <form style=\"display:contents\">\n"
"          <div style=\"display:flex;gap:8px;align-items:center\">\n"
"            <input id=\"mqtt_password\" type=\"password\" placeholder=\"(optional)\" style=\"flex:1\" autocomplete=\"off\">\n"
"            <button id=\"mqtt_pwd_toggle\" type=\"button\" class=\"toggle-btn\" title=\"Show/Hide\">üëÅ</button>\n"
"            <span id=\"mqtt_pwd_badge\" style=\"font-size:12px;color:var(--muted);min-width:40px;text-align:right\"></span>\n"
"          </div>\n"
"        </form>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">CA Certificate (TLS)</div>\n"
"        <textarea id=\"mqtt_ca_cert\" placeholder=\"PEM format (optional)\" style=\"min-height:60px;font-family:monospace;font-size:11px\"></textarea>\n"
"      </div>\n"
"    </div>\n"
"    <div class=\"button-group\" style=\"margin-top:16px\">\n"
"      <button id=\"mqtt_save\" class=\"success\">Save & Connect</button>\n"
"      <button id=\"mqtt_test\" class=\"ghost\">Test Publish</button>\n"
"      <button id=\"mqtt_clear\" class=\"danger\">Clear All</button>\n"
"    </div>\n"
"  </section>\n"
"\n"
"  <section class=\"card\">\n"
"    <h3>üìç AS3935 Sensor - I2C Configuration</h3>\n"
"    <div class=\"info\">‚ö†Ô∏è <strong>GPIO 11-21 are reserved</strong> (flash/UART) - use GPIO 0-10 or 22-27 only. Default pins are safe (SDA=21, SCL=22, IRQ=0). The fields below show your current saved configuration. Changing pins will reset the I2C bus.</div>\n"
"    <div id=\"as3935_status_box\" class=\"status-box disconnected\" style=\"display:none;margin-bottom:12px\">\n"
"      <div style=\"flex:1\">\n"
"        <div style=\"font-size:12px;color:#666;margin-bottom:4px\">Sensor Status</div>\n"
"        <div class=\"status-text\" id=\"as3935_status_text\">Initializing...</div>\n"
"        <div id=\"as3935_status_details\" style=\"font-size:11px;color:#666;margin-top:6px\"></div>\n"
"      </div>\n"
"      <button id=\"as3935_refresh\" class=\"ghost\" style=\"width:auto;align-self:flex-start\">üîÑ Refresh</button>\n"
"    </div>\n"
"    <div class=\"grid grid-3\">\n"
"      <div>\n"
"        <div class=\"label\">I2C Port</div>\n"
"        <input id=\"as3935_i2c_port\" type=\"number\" placeholder=\"0\" min=\"0\" max=\"1\" value=\"0\">\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">0 or 1</div>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">SDA Pin (Data)</div>\n"
"        <input id=\"as3935_sda\" type=\"number\" placeholder=\"21\" min=\"0\" max=\"47\" value=\"21\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">SCL Pin (Clock)</div>\n"
"        <input id=\"as3935_scl\" type=\"number\" placeholder=\"22\" min=\"0\" max=\"47\" value=\"22\">\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">IRQ Pin</div>\n"
"        <input id=\"as3935_irq\" type=\"number\" placeholder=\"0\" min=\"-1\" max=\"47\" value=\"0\">\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">Use -1 to disable IRQ</div>\n"
"      </div>\n"
"      <div>\n"
"        <div class=\"label\">I2C Address (Hex)</div>\n"
"        <input id=\"as3935_addr\" type=\"text\" placeholder=\"0x03\" value=\"0x03\">\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">E.g., 0x03, 0x02 (must be 0x00-0xFF)</div>\n"
"      </div>\n"
"    </div>\n"
"    <div class=\"button-group\" style=\"margin-top:16px\">\n"
"      <button id=\"as3935_save\" class=\"success\">Save Pins</button>\n"
"      <button id=\"as3935_save_addr\" class=\"success\">Save Address</button>\n"
"      <button id=\"as3935_status\" class=\"ghost\">View Details</button>\n"
"    </div>\n"
"  </section>\n"
"\n"
"  <section class=\"card\">\n"
"    <h3>‚öôÔ∏è AS3935 Sensor - Advanced Settings <span id=\"settings_loading_indicator\" style=\"display:none;font-size:14px;color:var(--muted)\">‚è≥ Loading...</span></h3>\n"
"    <div class=\"info\">Fine-tune lightning detection sensitivity and behavior. Click the <strong>‚ÑπÔ∏è Info</strong> button next to each setting to learn more.</div>\n"
"    \n"
"    <div class=\"grid grid-3\" style=\"margin-bottom:16px\">\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Environment Mode</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('afe')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <select id=\"as3935_afe\">\n"
"          <option value=\"0\">Select...</option>\n"
"          <option value=\"18\">üè† Indoor (more sensitive)</option>\n"
"          <option value=\"14\">üèûÔ∏è Outdoor (less sensitive)</option>\n"
"        </select>\n"
"      </div>\n"
"\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Noise Level Threshold</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('noise')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <select id=\"as3935_noise_level\">\n"
"          <option value=\"\">Select...</option>\n"
"          <option value=\"0\">Level 0: 390¬µV (least noise rejection)</option>\n"
"          <option value=\"1\">Level 1: 630¬µV</option>\n"
"          <option value=\"2\">Level 2: 860¬µV (default)</option>\n"
"          <option value=\"3\">Level 3: 1100¬µV</option>\n"
"          <option value=\"4\">Level 4: 1140¬µV</option>\n"
"          <option value=\"5\">Level 5: 1570¬µV</option>\n"
"          <option value=\"6\">Level 6: 1800¬µV</option>\n"
"          <option value=\"7\">Level 7: 2000¬µV (most noise rejection)</option>\n"
"        </select>\n"
"      </div>\n"
"\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Spike Rejection (0-15)</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('spike')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <input id=\"as3935_spike_rejection\" type=\"number\" min=\"0\" max=\"15\" placeholder=\"0-15\">\n"
"      </div>\n"
"\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Min Lightning Strikes</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('strikes')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <select id=\"as3935_min_strikes\">\n"
"          <option value=\"\">Select...</option>\n"
"          <option value=\"0\">1 Strike (most sensitive)</option>\n"
"          <option value=\"1\">5 Strikes</option>\n"
"          <option value=\"2\">9 Strikes</option>\n"
"          <option value=\"3\">16 Strikes (least sensitive)</option>\n"
"        </select>\n"
"      </div>\n"
"\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Watchdog Threshold (0-10)</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('watchdog')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <input id=\"as3935_watchdog\" type=\"number\" min=\"0\" max=\"10\" placeholder=\"0-10\">\n"
"      </div>\n"
"\n"
"      <div>\n"
"        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n"
"          <div class=\"label\">Disturber Detection</div>\n"
"          <button class=\"ghost\" style=\"padding:4px 8px;font-size:12px;width:auto\" onclick=\"showSettingInfo('disturber')\">‚ÑπÔ∏è Info</button>\n"
"        </div>\n"
"        <div style=\"display:flex;gap:8px;height:40px\">\n"
"          <button id=\"as3935_disturber_on\" class=\"ghost\" style=\"flex:1\">‚úì Enabled</button>\n"
"          <button id=\"as3935_disturber_off\" class=\"ghost\" style=\"flex:1\">‚úó Disabled</button>\n"
"        </div>\n"
"      </div>\n"
"    </div>\n"
"\n"
"    <div class=\"button-group\" style=\"margin-bottom:16px\">\n"
"      <button id=\"as3935_apply_settings\" class=\"success\" style=\"flex:1\">üíæ Apply Settings</button>\n"
"    </div>\n"
"\n"
"    <div class=\"grid\">\n"
"      <div>\n"
"        <button id=\"system_reboot\" class=\"danger\" style=\"width:100%\">üîÑ Reboot Device</button>\n"
"        <div style=\"font-size:11px;color:var(--muted);margin-top:4px\">Restarting will reconnect to WiFi and MQTT</div>\n"
"      </div>\n"
"    </div>\n"
"  </section>\n"
"\n"
"  <!-- Settings Info Modal -->\n"
"  <div id=\"settings_info_modal\" style=\"display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1001;overflow:auto\">\n"
"    <div style=\"background:white;margin:20px auto;padding:20px;border-radius:12px;max-width:600px\">\n"
"      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:16px\">\n"
"        <h2 style=\"margin:0\">Setting Information</h2>\n"
"        <button class=\"ghost\" style=\"padding:4px 8px\" onclick=\"document.getElementById('settings_info_modal').style.display='none'\">‚úï Close</button>\n"
"      </div>\n"
"      <p id=\"settings_info_content\" style=\"font-size:14px;white-space:pre-wrap;line-height:1.6;max-height:400px;overflow-y:auto;margin:0\">\n"
"        <!-- Content will be populated by JavaScript -->\n"
"      </p>\n"
"    </div>\n"
"  </div>\n"
"\n"
"  <!-- Register Guide Modal (kept for backward compatibility) -->\n"
"  <div id=\"register_guide_modal\" style=\"display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;overflow:auto\">\n"
"    <div style=\"background:white;margin:20px auto;padding:20px;border-radius:12px;max-width:600px\">\n"
"      <h2 style=\"margin-top:0\">AS3935 Register Guide</h2>\n"
"      <div style=\"max-height:400px;overflow-y:auto;font-size:13px\">\n"
"        <table style=\"width:100%;border-collapse:collapse\">\n"
"          <tr style=\"background:#f0f0f0\">\n"
"            <th style=\"padding:8px;text-align:left;border-bottom:1px solid #ccc\">Register</th>\n"
"            <th style=\"padding:8px;text-align:left;border-bottom:1px solid #ccc\">Name</th>\n"
"            <th style=\"padding:8px;text-align:left;border-bottom:1px solid #ccc\">Description</th>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x00</strong></td>\n"
"            <td style=\"padding:8px\">AFE Gain</td>\n"
"            <td style=\"padding:8px\">Controls receiver gain (0x00-0xFF, typical: 0x24)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x01</strong></td>\n"
"            <td style=\"padding:8px\">Threshold</td>\n"
"            <td style=\"padding:8px\">Lightning detection threshold (0x00-0xFF, typical: 0x22)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x02</strong></td>\n"
"            <td style=\"padding:8px\">Config</td>\n"
"            <td style=\"padding:8px\">General configuration (0x00-0xFF)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x03</strong></td>\n"
"            <td style=\"padding:8px\">Status</td>\n"
"            <td style=\"padding:8px\">Lightning event status (read-only)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x04</strong></td>\n"
"            <td style=\"padding:8px\">L.Energy MSB</td>\n"
"            <td style=\"padding:8px\">Lightning energy MSB (read-only)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x05</strong></td>\n"
"            <td style=\"padding:8px\">L.Energy MID</td>\n"
"            <td style=\"padding:8px\">Lightning energy middle byte (read-only)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x06</strong></td>\n"
"            <td style=\"padding:8px\">L.Energy LSB</td>\n"
"            <td style=\"padding:8px\">Lightning energy LSB (read-only)</td>\n"
"          </tr>\n"
"          <tr style=\"border-bottom:1px solid #eee\">\n"
"            <td style=\"padding:8px\"><strong>0x07</strong></td>\n"
"            <td style=\"padding:8px\">Calibration</td>\n"
"            <td style=\"padding:8px\">RLC calibration (tuning, typical: 0x00-0x0F)</td>\n"
"          </tr>\n"
"          <tr>\n"
"            <td style=\"padding:8px\"><strong>0x08</strong></td>\n"
"            <td style=\"padding:8px\">Distance</td>\n"
"            <td style=\"padding:8px\">Lightning distance estimate in km (read-only)</td>\n"
"          </tr>\n"
"        </table>\n"
"      </div>\n"
"      <button onclick=\"document.getElementById('register_guide_modal').style.display='none'\" style=\"margin-top:12px;width:100%\">Close</button>\n"
"    </div>\n"
"  </div>\n"
"\n"
"</main>\n"
"<script>\n"
"// Suppress browser extension errors that don't affect our app\n"
"window.addEventListener('unhandledrejection', event => {\n"
"  if (event.reason && (\n"
"    String(event.reason).includes('sentence') ||\n"
"    String(event.reason).includes('contentScript') ||\n"
"    String(event.reason).includes('chrome-extension')\n"
"  )) {\n"
"    console.warn('[Browser extension error suppressed]');\n"
"    event.preventDefault();\n"
"  }\n"
"});\n"
"\n"
"(function(){\n"
"  let mqtt_check_interval = null;\n"
"  \n"
"  async function jsonReq(u,o){ try{ const r = await fetch(u,o); if(!r.ok) return null; return await r.json(); }catch(e){return null;} }\n"
"  function setBadge(id,text){ const el = document.getElementById(id); if(el) el.innerText = text || ''; }\n"
"  function toggle(id){ const el=document.getElementById(id); if(!el) return; el.type = el.type==='password' ? 'text' : 'password'; }\n"
"\n"
"  function showRegisterGuide(e){\n"
"    if(e) e.preventDefault();\n"
"    document.getElementById('register_guide_modal').style.display = 'block';\n"
"  }\n"
"  window.showRegisterGuide = showRegisterGuide;\n"
"\n"
"  async function scanWiFiNetworks(){\n"
"    try {\n"
"      const select = document.getElementById('wifi_ssid_select');\n"
"      select.innerHTML = '<option value=\"\">Scanning...</option>';\n"
"      const networks = await jsonReq('/api/wifi/scan');\n"
"      if(!networks || networks.length === 0){\n"
"        select.innerHTML = '<option value=\"\">No networks found</option>';\n"
"        return;\n"
"      }\n"
"      select.innerHTML = '<option value=\"\">-- Select Network --</option>';\n"
"      networks.forEach(net => {\n"
"        const opt = document.createElement('option');\n"
"        opt.value = net.ssid;\n"
"        opt.textContent = net.ssid + (net.rssi ? ` (${net.rssi}dBm)` : '');\n"
"        select.appendChild(opt);\n"
"      });\n"
"    } catch(e){\n"
"      console.error('Scan error:', e);\n"
"    }\n"
"  }\n"
"\n"
"  async function updateWiFiStatus(){\n"
"    const w = await jsonReq('/api/wifi/status');\n"
"    if(w){\n"
"      document.getElementById('wifi_current_ssid').innerText = w.ssid || 'Not connected';\n"
"      document.getElementById('wifi_signal').innerText = w.signal ? w.signal + '%' : '';\n"
"      document.getElementById('wifi_status').innerText = w.ip ? `IP: ${w.ip}` : 'Connecting...';\n"
"      if(w.password_set){ \n"
"        document.getElementById('wifi_password').placeholder='saved (leave empty)'; \n"
"        setBadge('wifi_pwd_badge','saved'); \n"
"      }\n"
"    }\n"
"  }\n"
"\n"
"  async function updateMqttStatus(auto_refresh=false){\n"
"    const m = await jsonReq('/api/mqtt/status');\n"
"    if(!m) return;\n"
"    \n"
"    // Only update configuration fields on initial load, not on auto-refresh\n"
"    // This prevents overwriting user input while they're editing\n"
"    if(!auto_refresh) {\n"
"      // Parse URI into components (mqtt://host:port or mqtts://host:port)\n"
"      if(m.uri) {\n"
"        try {\n"
"          const url = new URL(m.uri);\n"
"          document.getElementById('mqtt_protocol').value = url.protocol === 'mqtts:' ? 'mqtts' : 'mqtt';\n"
"          document.getElementById('mqtt_host').value = url.hostname || '';\n"
"          document.getElementById('mqtt_port').value = url.port || (url.protocol === 'mqtts:' ? '8883' : '1883');\n"
"        } catch(e) {\n"
"          // If parsing fails, try manual extraction\n"
"          const match = m.uri.match(/^(mqtts?):\\/\\/([^:]+):?(\\d+)?$/);\n"
"          if(match) {\n"
"            document.getElementById('mqtt_protocol').value = match[1];\n"
"            document.getElementById('mqtt_host').value = match[2];\n"
"            document.getElementById('mqtt_port').value = match[3] || (match[1] === 'mqtts' ? '8883' : '1883');\n"
"          }\n"
"        }\n"
"      }\n"
"      \n"
"      document.getElementById('mqtt_topic').value = m.topic || 'as3935/lightning';\n"
"      document.getElementById('mqtt_availability_topic').value = m.availability_topic || 'as3935/availability';\n"
"      document.getElementById('mqtt_username').value = m.username||'';\n"
"      if(m.ca_cert) document.getElementById('mqtt_ca_cert').value = m.ca_cert;\n"
"    }\n"
"    \n"
"    // Always update password badge (since we don't show the actual password)\n"
"    if(m.password_set){ \n"
"      document.getElementById('mqtt_password').placeholder='saved (leave empty)'; \n"
"      setBadge('mqtt_pwd_badge','saved'); \n"
"    } else {\n"
"      document.getElementById('mqtt_password').placeholder='(optional)';\n"
"      setBadge('mqtt_pwd_badge','');\n"
"    }\n"
"    \n"
"    const statusEl = document.getElementById('mqtt_status_display');\n"
"    const statusBox = document.getElementById('mqtt_status_box');\n"
"    if(!statusEl || !statusBox) return;\n"
"    \n"
"    statusBox.className = 'status-box';\n"
"    if(m.connected){\n"
"      statusEl.innerText = '‚úì Connected';\n"
"      statusEl.className = 'status-text connected';\n"
"      statusBox.classList.add('connected');\n"
"    } else if(m.configured){\n"
"      statusEl.innerHTML = '<span class=\"spinner\"></span> Connecting...';\n"
"      statusEl.className = 'status-text connecting';\n"
"      statusBox.classList.add('connecting');\n"
"    } else {\n"
"      statusEl.innerText = '‚úó Not Configured';\n"
"      statusEl.className = 'status-text disconnected';\n"
"      statusBox.classList.add('disconnected');\n"
"    }\n"
"  }\n"
"\n"
"  async function updateAs3935Status(){\n"
"    const status = await jsonReq('/api/as3935/status');\n"
"    const statusBox = document.getElementById('as3935_status_box');\n"
"    const statusText = document.getElementById('as3935_status_text');\n"
"    const statusDetails = document.getElementById('as3935_status_details');\n"
"    \n"
"    if(!statusBox || !statusText || !statusDetails) return;\n"
"    \n"
"    if(status) {\n"
"      statusBox.style.display = 'flex';\n"
"      \n"
"      // Check if sensor is initialized (i2c_dev is not NULL)\n"
"      if(status.initialized === true || status.initialized === 'true') {\n"
"        // Sensor is initialized and responding\n"
"        statusBox.className = 'status-box connected';\n"
"        statusText.className = 'status-text connected';\n"
"        statusText.innerHTML = `‚úì <strong>Sensor Active & Responding</strong>`;\n"
"        statusDetails.innerHTML = `\n"
"          <strong>Register Status:</strong><br/>\n"
"          R0 (System): ${status.r0}<br/>\n"
"          R1 (Config): ${status.r1}<br/>\n"
"          R3 (Lightning): ${status.r3}<br/>\n"
"          R8 (Distance): ${status.r8}\n"
"        `;\n"
"      } else {\n"
"        // Sensor not responding\n"
"        statusBox.className = 'status-box disconnected';\n"
"        statusText.className = 'status-text disconnected';\n"
"        statusText.innerHTML = '‚úó <strong>Sensor Not Responding</strong>';\n"
"        statusDetails.innerHTML = `\n"
"          <strong>Troubleshooting:</strong><br/>\n"
"          ‚Ä¢ Check I2C address (try 0x01, 0x02, 0x03)<br/>\n"
"          ‚Ä¢ Verify GPIO 7 (SDA) and GPIO 4 (SCL) wiring<br/>\n"
"          ‚Ä¢ Confirm 3.3V power and GND connection<br/>\n"
"          ‚Ä¢ See URGENT_I2C_NACK_ERROR.md for help\n"
"        `;\n"
"      }\n"
"    } else {\n"
"      statusBox.style.display = 'none';\n"
"    }\n"
"  }\n"
"\n"
"  // Setting descriptions for info modal (global scope for onclick handlers)\n"
"  const settingDescriptions = {\n"
"    afe: \"üåç ENVIRONMENT MODE\\n\\nDetermines the sensitivity of the AS3935 sensor for different environments.\\n\\nüìä INDOOR (Value: 18)\\n‚Ä¢ More sensitive to weak lightning signals\\n‚Ä¢ Better for detecting distant lightning indoors\\n‚Ä¢ Increases sensitivity by ~20-30%\\n‚Ä¢ Recommended when you want maximum detection range\\n\\nüèûÔ∏è OUTDOOR (Value: 14)\\n‚Ä¢ Less sensitive, more selective\\n‚Ä¢ Better at filtering out man-made electrical noise\\n‚Ä¢ Recommended for locations with high electrical activity\\n‚Ä¢ Reduces false positives from nearby power lines and machinery\\n\\nüí° TIPS:\\n‚Ä¢ Start with INDOOR in quiet areas, switch to OUTDOOR if you get too many false alarms\\n‚Ä¢ INDOOR is better for open fields away from electrical noise\\n‚Ä¢ OUTDOOR is better for urban/industrial areas\",\n"
"    \n"
"    noise: \"üîä NOISE LEVEL THRESHOLD\\n\\nControls the sensor's immunity to electrical noise.\\n\\nüìà SENSITIVITY SCALE (0-7):\\n‚Ä¢ Level 0 (390¬µV): Lowest immunity - detects very weak signals but prone to false positives\\n‚Ä¢ Level 1 (630¬µV): Low immunity\\n‚Ä¢ Level 2 (860¬µV): DEFAULT - good balance for most applications\\n‚Ä¢ Level 3 (1100¬µV): Moderate immunity\\n‚Ä¢ Level 4 (1140¬µV): Moderate-high immunity\\n‚Ä¢ Level 5 (1570¬µV): High immunity\\n‚Ä¢ Level 6 (1800¬µV): Very high immunity\\n‚Ä¢ Level 7 (2000¬µV): Maximum immunity - ignores weak signals\\n\\n‚öôÔ∏è WHAT IT DOES:\\n‚Ä¢ Higher values = more noise rejection but misses weaker lightning\\n‚Ä¢ Lower values = better detection but more false alarms from electrical noise\\n\\nüéØ RECOMMENDATIONS:\\n‚Ä¢ Electrical noise area? Increase to 4-5\\n‚Ä¢ Need maximum detection? Use 0-1\\n‚Ä¢ Default works well for most areas\",\n"
"    \n"
"    spike: \"‚ö° SPIKE REJECTION\\n\\nFilters out very short, high-amplitude electrical transients that aren't lightning.\\n\\nüìä VALUE RANGE (0-15):\\n‚Ä¢ 0: No rejection - detects all spikes (maximum sensitivity)\\n‚Ä¢ 1-5: Low rejection - good balance\\n‚Ä¢ 6-11: Moderate rejection - filters some noise\\n‚Ä¢ 12-15: Maximum rejection - ignores fast transients\\n\\nüîç WHAT IT FILTERS:\\n‚Ä¢ Electronic switching transients (power supplies, relays)\\n‚Ä¢ Fast electrical pulses from machinery\\n‚Ä¢ RF noise from WiFi and cell towers\\n‚Ä¢ NOT actual lightning which has slower rise times\\n\\nüí° RECOMMENDED VALUES:\\n‚Ä¢ Clean electrical environment: 0-2\\n‚Ä¢ Some noise: 3-5 (good default)\\n‚Ä¢ High noise area: 8-12\\n‚Ä¢ Industrial area: 12-15\\n\\n‚ö†Ô∏è NOTE: Setting too high may miss genuine lightning events\",\n"
"    \n"
"    strikes: \"‚ö° MINIMUM LIGHTNING STRIKES\\n\\nRequires multiple lightning detections before reporting an event.\\n\\nüìä STRIKE OPTIONS:\\n‚Ä¢ 1 Strike (Value: 0): Report every detection - maximum sensitivity\\n‚Ä¢ 5 Strikes (Value: 1): Good balance - medium sensitivity\\n‚Ä¢ 9 Strikes (Value: 2): Higher threshold - fewer false positives\\n‚Ä¢ 16 Strikes (Value: 3): Maximum threshold - least sensitive\\n\\nüéØ HOW IT WORKS:\\nThe sensor collects rapid pulses of electromagnetic energy. This setting requires X pulses to confirm a lightning strike.\\n\\nüí° RECOMMENDED VALUES:\\n‚Ä¢ Research/testing: Use 1 Strike (maximum sensitivity)\\n‚Ä¢ General use: Use 5 Strikes (good balance)\\n‚Ä¢ Noisy environment: Use 9-16 Strikes (reduces false positives)\\n‚Ä¢ High accuracy needed: Use 9-16 Strikes\\n\\n‚ö†Ô∏è TRADEOFF:\\n‚Ä¢ Lower values = detect more distant/weak lightning but more false alarms\\n‚Ä¢ Higher values = fewer false alarms but might miss weak events\",\n"
"    \n"
"    watchdog: \"‚è±Ô∏è WATCHDOG THRESHOLD (0-10)\\n\\nControls the timeout period after detecting activity.\\n\\nüîÑ WHAT IT DOES:\\nAfter the sensor detects lightning or disturber activity, it waits this amount of time before it's ready to report another event.\\n\\nüìä TIMING SCALE:\\n‚Ä¢ Value 0: Minimum wait time (~16ms)\\n‚Ä¢ Value 5: Medium wait time\\n‚Ä¢ Value 10: Maximum wait time (~288ms)\\n\\nHigher values give the sensor more time to \\\"settle\\\" after detecting an event.\\n\\n‚öôÔ∏è PRACTICAL USE:\\n‚Ä¢ 0-2: Fast response, good for continuous monitoring\\n‚Ä¢ 3-5: Balanced - prevents rapid re-triggering\\n‚Ä¢ 6-10: Slow response, filters out multiple pulses\\n\\nüí° RECOMMENDATIONS:\\n‚Ä¢ For weather monitoring: Use 3-5\\n‚Ä¢ For event counting: Use 0-2\\n‚Ä¢ Noisy environment: Use 5-10\\n\\nüìù NOTE: Related to internal sensor timing, affects how soon after one event another can be detected\",\n"
"    \n"
"    disturber: \"üö´ DISTURBER DETECTION\\n\\nEnables/disables the sensor's ability to distinguish between true lightning and man-made electrical disturbances.\\n\\n‚úÖ ENABLED:\\n‚Ä¢ Sensor actively identifies non-lightning disturbances\\n‚Ä¢ Only reports confirmed lightning events\\n‚Ä¢ Filters out: power line switching, motor starts, radio transmissions\\n‚Ä¢ Better accuracy for lightning detection\\n‚Ä¢ RECOMMENDED for most applications\\n\\n‚ùå DISABLED:\\n‚Ä¢ Reports ALL electromagnetic activity detected\\n‚Ä¢ Includes both lightning AND man-made disturbances\\n‚Ä¢ Useful if you need to monitor all electrical activity\\n‚Ä¢ May generate many false alarms if in noisy area\\n\\nüìä DETECTION ALGORITHM:\\nWhen enabled, the AS3935 analyzes the energy signature and rise time of detected events to separate true lightning (characteristic 10¬µs+ rise time) from faster switching transients.\\n\\nüí° WHEN TO USE EACH:\\n‚Ä¢ Lightning monitoring/weather station: Use ENABLED\\n‚Ä¢ Research/electrical activity logging: Use DISABLED\\n‚Ä¢ High noise area: Use ENABLED for better accuracy\\n\\n‚ö†Ô∏è NOTE: Even with disturber detection enabled, some false positives may occur in electrically noisy environments\"\n"
"  };\n"
"\n"
"  // Show setting info modal (global scope for onclick handlers)\n"
"  function showSettingInfo(settingName) {\n"
"    try {\n"
"      const modal = document.getElementById('settings_info_modal');\n"
"      if (!modal) {\n"
"        console.error('Modal element not found:', 'settings_info_modal');\n"
"        return;\n"
"      }\n"
"      const title = modal.querySelector('h2');\n"
"      const content = modal.querySelector('p');\n"
"      if (!title || !content) {\n"
"        console.error('Modal elements not found - title:', title, 'content:', content);\n"
"        return;\n"
"      }\n"
"      title.textContent = 'Setting Information';\n"
"      content.textContent = settingDescriptions[settingName] || 'No information available for this setting.';\n"
"      modal.style.display = 'block';\n"
"      console.log('Showing info for:', settingName);\n"
"    } catch(e) {\n"
"      console.error('Error in showSettingInfo:', e);\n"
"    }\n"
"  }\n"
"  \n"
"  // Expose to global scope for onclick handlers\n"
"  window.showSettingInfo = showSettingInfo;\n"
"\n"
"  // Load advanced settings from NVS into form fields with retry logic\n"
"  async function loadSettings() {\n"
"    const loadingIndicator = document.getElementById('settings_loading_indicator');\n"
"    const defaults = {\n"
"      afe: 18,\n"
"      noise_level: 2,\n"
"      spike_rejection: 2,\n"
"      min_strikes: 0,\n"
"      disturber_enabled: true,\n"
"      watchdog: 2\n"
"    };\n"
"    \n"
"    // Retry function with exponential backoff\n"
"    const fetchWithRetry = async (url, maxRetries = 3) => {\n"
"      for (let i = 0; i < maxRetries; i++) {\n"
"        try {\n"
"          const controller = new AbortController();\n"
"          const timeoutId = setTimeout(() => controller.abort(), 5000);\n"
"          \n"
"          const response = await fetch(url, { signal: controller.signal });\n"
"          clearTimeout(timeoutId);\n"
"          \n"
"          if (response.ok) {\n"
"            return await response.json();\n"
"          }\n"
"        } catch (e) {\n"
"          if (i < maxRetries - 1) {\n"
"            // Wait before retrying (100ms, 200ms, 400ms)\n"
"            await new Promise(resolve => setTimeout(resolve, 100 * Math.pow(2, i)));\n"
"          }\n"
"        }\n"
"      }\n"
"      return null;\n"
"    };\n"
"    \n"
"    try {\n"
"      // Show loading indicator\n"
"      if(loadingIndicator) loadingIndicator.style.display = 'inline';\n"
"      \n"
"      console.log('Starting loadSettings with retry logic...');\n"
"      \n"
"      // Load all settings sequentially with null checks to avoid race conditions\n"
"      const afe = await fetchWithRetry('/api/as3935/settings/afe');\n"
"      const noise = await fetchWithRetry('/api/as3935/settings/noise-level');\n"
"      const spike = await fetchWithRetry('/api/as3935/settings/spike-rejection');\n"
"      const strikes = await fetchWithRetry('/api/as3935/settings/min-strikes');\n"
"      const watchdog = await fetchWithRetry('/api/as3935/settings/watchdog');\n"
"      const disturber = await fetchWithRetry('/api/as3935/settings/disturber');\n"
"\n"
"      // AFE - Set the select to match the current value\n"
"      if(afe && (typeof afe.afe !== 'undefined' || typeof afe.afe_name !== 'undefined')) {\n"
"        const afeVal = String(afe.afe || defaults.afe);\n"
"        const afeSelect = document.getElementById('as3935_afe');\n"
"        if(afeSelect) {\n"
"          afeSelect.value = afeVal;\n"
"          console.log('‚úì AFE loaded: ' + afeVal);\n"
"        }\n"
"      }\n"
"\n"
"      // Noise Level\n"
"      if(noise && typeof noise.noise_level !== 'undefined') {\n"
"        const noiseVal = String(noise.noise_level);\n"
"        const noiseSelect = document.getElementById('as3935_noise_level');\n"
"        if(noiseSelect) {\n"
"          noiseSelect.value = noiseVal;\n"
"          console.log('‚úì Noise level loaded: ' + noiseVal);\n"
"        }\n"
"      }\n"
"\n"
"      // Spike Rejection\n"
"      if(spike && typeof spike.spike_rejection !== 'undefined') {\n"
"        const spikeVal = String(spike.spike_rejection);\n"
"        const spikeInput = document.getElementById('as3935_spike_rejection');\n"
"        if(spikeInput) {\n"
"          spikeInput.value = spikeVal;\n"
"          console.log('‚úì Spike rejection loaded: ' + spikeVal);\n"
"        }\n"
"      }\n"
"\n"
"      // Min Strikes\n"
"      if(strikes && typeof strikes.min_strikes !== 'undefined') {\n"
"        const strikesVal = String(strikes.min_strikes);\n"
"        const strikesSelect = document.getElementById('as3935_min_strikes');\n"
"        if(strikesSelect) {\n"
"          strikesSelect.value = strikesVal;\n"
"          console.log('‚úì Min strikes loaded: ' + strikesVal);\n"
"        }\n"
"      }\n"
"\n"
"      // Watchdog\n"
"      if(watchdog && typeof watchdog.watchdog !== 'undefined') {\n"
"        const watchdogVal = String(watchdog.watchdog);\n"
"        const watchdogInput = document.getElementById('as3935_watchdog');\n"
"        if(watchdogInput) {\n"
"          watchdogInput.value = watchdogVal;\n"
"          console.log('‚úì Watchdog loaded: ' + watchdogVal);\n"
"        }\n"
"      }\n"
"\n"
"      // Disturber Detection\n"
"      if(disturber && typeof disturber.disturber_enabled !== 'undefined') {\n"
"        const enabled = Boolean(disturber.disturber_enabled === true || disturber.disturber_enabled === 'true' || disturber.disturber_enabled === 1);\n"
"        const onBtn = document.getElementById('as3935_disturber_on');\n"
"        const offBtn = document.getElementById('as3935_disturber_off');\n"
"        \n"
"        if(onBtn && offBtn) {\n"
"          // Remove all state classes first\n"
"          onBtn.classList.remove('btn-active', 'btn-secondary');\n"
"          offBtn.classList.remove('btn-active', 'btn-secondary');\n"
"          \n"
"          if(enabled) {\n"
"            onBtn.classList.add('btn-active');\n"
"            offBtn.classList.add('btn-secondary');\n"
"            console.log('‚úì Disturber loaded: ON');\n"
"          } else {\n"
"            offBtn.classList.add('btn-active');\n"
"            onBtn.classList.add('btn-secondary');\n"
"            console.log('‚úì Disturber loaded: OFF');\n"
"          }\n"
"        }\n"
"      }\n"
"      \n"
"      console.log('‚úì Settings loaded successfully');\n"
"      \n"
"      // Hide loading indicator\n"
"      if(loadingIndicator) loadingIndicator.style.display = 'none';\n"
"    } catch(e) {\n"
"      console.error('Error loading settings:', e);\n"
"      // Don't alert - silently fail and use defaults\n"
"      // alert('Error loading settings. Check browser console for details.');\n"
"      \n"
"      // Hide loading indicator on error too\n"
"      if(loadingIndicator) loadingIndicator.style.display = 'none';\n"
"    }\n"
"  }\n"
"\n"
"  async function load(){\n"
"    await updateWiFiStatus();\n"
"    await updateMqttStatus();\n"
"    await scanWiFiNetworks();\n"
"    \n"
"    const s = await jsonReq('/api/as3935/pins/status');\n"
"    if(s){ \n"
"      document.getElementById('as3935_i2c_port').value = s.i2c_port != null ? s.i2c_port : ''; \n"
"      document.getElementById('as3935_sda').value = s.sda != null ? s.sda : ''; \n"
"      document.getElementById('as3935_scl').value = s.scl != null ? s.scl : ''; \n"
"      document.getElementById('as3935_irq').value = s.irq != null ? s.irq : ''; \n"
"    }\n"
"    \n"
"    const addr = await jsonReq('/api/as3935/address/status');\n"
"    if(addr) {\n"
"      document.getElementById('as3935_addr').value = addr.i2c_addr || '0x03';\n"
"    }\n"
"    \n"
"    await updateAs3935Status();\n"
"    \n"
"    // Load advanced settings from NVS - start immediately, no delay\n"
"    loadSettings();\n"
"    \n"
"    // Auto-refresh sensor status every 3 seconds\n"
"    setInterval(updateAs3935Status, 3000);\n"
"    \n"
"    // Register all event listeners after DOM is ready\n"
"    registerEventListeners();\n"
"  }\n"
"  \n"
"  function registerEventListeners(){\n"
"    // Helper function for safe element selection\n"
"    const safeId = (id) => {\n"
"      const el = document.getElementById(id);\n"
"      // Silently return null if element not found - the code already checks with if()\n"
"      return el;\n"
"    };\n"
"    \n"
"    try {\n"
"    // WiFi handlers\n"
"    const wifi_pwd_toggle = safeId('wifi_pwd_toggle');\n"
"    if(wifi_pwd_toggle) wifi_pwd_toggle.addEventListener('click', ()=>toggle('wifi_password'));\n"
"    \n"
"    const wifi_scan = safeId('wifi_scan');\n"
"    if(wifi_scan) wifi_scan.addEventListener('click', scanWiFiNetworks);\n"
"  \n"
"    const wifi_ssid_select = safeId('wifi_ssid_select');\n"
"    if(wifi_ssid_select) wifi_ssid_select.addEventListener('change', (e) => {\n"
"      if(e.target.value) {\n"
"        const wifi_ssid_manual = safeId('wifi_ssid_manual');\n"
"        if(wifi_ssid_manual) wifi_ssid_manual.value = '';\n"
"      }\n"
"    });\n"
"  \n"
"    const wifi_ssid_manual = safeId('wifi_ssid_manual');\n"
"    if(wifi_ssid_manual) wifi_ssid_manual.addEventListener('input', (e) => {\n"
"      if(e.target.value) {\n"
"        const wifi_ssid_select = safeId('wifi_ssid_select');\n"
"        if(wifi_ssid_select) wifi_ssid_select.value = '';\n"
"      }\n"
"    });\n"
"\n"
"    const wifi_save = safeId('wifi_save');\n"
"    if(wifi_save) wifi_save.addEventListener('click', async ()=>{\n"
"      const ssid = (safeId('wifi_ssid_select')?.value || '') || (safeId('wifi_ssid_manual')?.value || '');\n"
"      if(!ssid){\n"
"        alert('‚ö†Ô∏è Please select or enter an SSID');\n"
"        return;\n"
"      }\n"
"      const body = { ssid };\n"
"      const pw = safeId('wifi_password')?.value; \n"
"      if(pw && pw.length) body.password = pw;\n"
"      await fetch('/api/wifi/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});\n"
"      alert('‚úì Wi-Fi settings saved');\n"
"    });\n"
"\n"
"    const wifi_connect = safeId('wifi_connect');\n"
"    if(wifi_connect) wifi_connect.addEventListener('click', async ()=>{\n"
"      const ssid = (safeId('wifi_ssid_select')?.value || '') || (safeId('wifi_ssid_manual')?.value || '');\n"
"      if(!ssid){\n"
"        alert('‚ö†Ô∏è Please select or enter an SSID');\n"
"        return;\n"
"      }\n"
"      const body = { ssid, connect_now: true };\n"
"      const pw = safeId('wifi_password')?.value; \n"
"      if(pw && pw.length) body.password = pw;\n"
"      \n"
"      const wifi_status = safeId('wifi_status');\n"
"      if(wifi_status) wifi_status.innerText = 'Connecting...';\n"
"      await fetch('/api/wifi/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});\n"
"      \n"
"      // Wait a moment then try to detect new IP\n"
"      setTimeout(async () => {\n"
"        const status = await jsonReq('/api/wifi/status');\n"
"        if(status && status.ip){\n"
"          alert(`‚úì Connected!\\n\\nNew IP: ${status.ip}\\n\\nRedirecting...`);\n"
"          // Redirect to new IP (if changed)\n"
"          const newUrl = `http://${status.ip.split('.').slice(0,3).join('.')}.${status.ip.split('.')[3]}:80`;\n"
"          setTimeout(() => { window.location.href = newUrl; }, 1000);\n"
"        } else {\n"
"          if(wifi_status) wifi_status.innerText = 'Connection in progress...';\n"
"        }\n"
"      }, 3000);\n"
"    });\n"
"    \n"
"    // MQTT handlers\n"
"    const mqtt_pwd_toggle = safeId('mqtt_pwd_toggle');\n"
"    if(mqtt_pwd_toggle) mqtt_pwd_toggle.addEventListener('click', ()=>toggle('mqtt_password'));\n"
"\n"
"    const mqtt_save = safeId('mqtt_save');\n"
"    if(mqtt_save) mqtt_save.addEventListener('click', async ()=>{\n"
"      const protocol = safeId('mqtt_protocol')?.value;\n"
"      const host = safeId('mqtt_host')?.value;\n"
"      const port = safeId('mqtt_port')?.value;\n"
"      \n"
"      if(!host){\n"
"        alert('‚ö†Ô∏è Broker hostname/IP is required');\n"
"        return;\n"
"      }\n"
"      if(!port){\n"
"        alert('‚ö†Ô∏è Broker port is required');\n"
"        return;\n"
"      }\n"
"      \n"
"      // Construct URI from components\n"
"      const uri = `${protocol}://${host}:${port}`;\n"
"      \n"
"      const body = { \n"
"        uri,\n"
"        topic: safeId('mqtt_topic')?.value || 'as3935/lightning',\n"
"        availability_topic: safeId('mqtt_availability_topic')?.value || 'as3935/availability',\n"
"        username: safeId('mqtt_username')?.value \n"
"      };\n"
"      const pw = safeId('mqtt_password')?.value; \n"
"      if(pw && pw.length) body.password = pw;\n"
"      const ca = safeId('mqtt_ca_cert')?.value;\n"
"      if(ca && ca.length) body.ca_cert = ca;\n"
"      \n"
"      await fetch('/api/mqtt/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});\n"
"      const mqtt_pwd_badge = safeId('mqtt_pwd_badge');\n"
"      if(mqtt_pwd_badge) mqtt_pwd_badge.innerText = pw && pw.length ? 'saved':'saved';\n"
"      alert('‚úì MQTT settings saved - connecting...');\n"
"      await new Promise(r => setTimeout(r, 1000));\n"
"      await updateMqttStatus();\n"
"    });\n"
"\n"
"    const mqtt_test = safeId('mqtt_test');\n"
"    if(mqtt_test) mqtt_test.addEventListener('click', async ()=>{ \n"
"      const result = await fetch('/api/mqtt/test',{method:'POST'});\n"
"      const data = await result.json();\n"
"      if(data.ok){\n"
"        alert('‚úì Test message published successfully!');\n"
"      } else {\n"
"        let msg = data.error || 'Unknown error';\n"
"        if(data.message) msg += '\\n\\n' + data.message;\n"
"        if(msg.includes('no_mqtt_broker_configured')) msg = 'MQTT broker is not configured. Please enter a broker URI and save.';\n"
"        if(msg.includes('no_topic_configured')) msg = 'MQTT topic is not configured. A default topic has been set.';\n"
"        if(msg.includes('mqtt_not_connected')) msg = 'MQTT is not connected yet. This is normal if you just configured it. Wait 5-10 seconds and try again.';\n"
"        alert('‚úó Test publish failed:\\n\\n' + msg);\n"
"      }\n"
"    });\n"
"\n"
"    const mqtt_refresh = safeId('mqtt_refresh');\n"
"    if(mqtt_refresh) mqtt_refresh.addEventListener('click', async ()=>{\n"
"      await updateMqttStatus(true);\n"
"    });\n"
"    \n"
"    const mqtt_clear = safeId('mqtt_clear');\n"
"    if(mqtt_clear) mqtt_clear.addEventListener('click', async ()=>{\n"
"      if(!confirm('‚ö†Ô∏è Clear all MQTT settings?')) return;\n"
"      await fetch('/api/mqtt/clear_credentials',{method:'POST'});\n"
"      alert('‚úì MQTT settings cleared');\n"
"      await updateMqttStatus();\n"
"    });\n"
"\n"
"    // AS3935 handlers\n"
"    const as3935_save = safeId('as3935_save');\n"
"    if(as3935_save) as3935_save.addEventListener('click', async ()=>{\n"
"      const body = {\n"
"        i2c_port: parseInt(safeId('as3935_i2c_port')?.value) || 0,\n"
"        sda: parseInt(safeId('as3935_sda')?.value) || 21,\n"
"        scl: parseInt(safeId('as3935_scl')?.value) || 22,\n"
"        irq: parseInt(safeId('as3935_irq')?.value) || 0\n"
"      };\n"
"      const result = await fetch('/api/as3935/pins/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});\n"
"      if(result.ok) {\n"
"        alert('‚úì AS3935 pins saved successfully!');\n"
"        await updateAs3935Status();\n"
"      } else {\n"
"        const data = await result.json();\n"
"        alert('‚úó Error saving pins:\\n' + (data.error || 'Unknown error'));\n"
"      }\n"
"    });\n"
"\n"
"    const as3935_save_addr = safeId('as3935_save_addr');\n"
"    if(as3935_save_addr) as3935_save_addr.addEventListener('click', async ()=>{\n"
"      const addrStr = (safeId('as3935_addr')?.value || '').trim();\n"
"      let i2c_addr = 0x03;  // Default\n"
"      \n"
"      // Parse hex (0x03) or decimal (3) format\n"
"      if(addrStr.startsWith('0x') || addrStr.startsWith('0X')) {\n"
"        i2c_addr = parseInt(addrStr, 16);\n"
"      } else {\n"
"        i2c_addr = parseInt(addrStr, 10);\n"
"      }\n"
"      \n"
"      if(isNaN(i2c_addr) || i2c_addr < 0 || i2c_addr > 255) {\n"
"        alert('‚ö†Ô∏è Invalid address. Use 0x00-0xFF (hex) or 0-255 (decimal)');\n"
"        return;\n"
"      }\n"
"      \n"
"      const body = { i2c_addr };\n"
"      const result = await fetch('/api/as3935/address/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});\n"
"      if(result.ok) {\n"
"        alert(`‚úì AS3935 I2C address saved successfully! (0x${i2c_addr.toString(16).toUpperCase().padStart(2, '0')})`);\n"
"        // Reload address to confirm\n"
"        const addr = await jsonReq('/api/as3935/address/status');\n"
"        if(addr) {\n"
"          const addrField = safeId('as3935_addr');\n"
"          if(addrField) addrField.value = addr.i2c_addr;\n"
"        }\n"
"        await updateAs3935Status();\n"
"      } else {\n"
"        const data = await result.json();\n"
"        alert('‚úó Error saving address:\\n' + (data.error || 'Unknown error'));\n"
"      }\n"
"    });\n"
"\n"
"    const as3935_status = safeId('as3935_status');\n"
"    if(as3935_status) as3935_status.addEventListener('click', async ()=>{\n"
"      const status = await jsonReq('/api/as3935/status');\n"
"      if(status) {\n"
"        let msg = 'AS3935 Sensor Status\\n\\n';\n"
"        if(status.initialized === true || status.initialized === 'true') {\n"
"          msg += '‚úì Sensor Status: ACTIVE\\n';\n"
"          msg += `I2C Address: 0x${status.addr}\\n`;\n"
"          msg += `I2C Port: ${status.i2c_port}\\n`;\n"
"          msg += `SDA Pin: ${status.sda}\\n`;\n"
"          msg += `SCL Pin: ${status.scl}\\n`;\n"
"          msg += `IRQ Pin: ${status.irq_pin}\\n`;\n"
"          msg += `Verification Register: ${status.verification_register}\\n`;\n"
"          msg += `Sensor Handle Valid: ${status.sensor_handle_valid ? 'Yes' : 'No'}\\n`;\n"
"          msg += `Monitor Handle Valid: ${status.monitor_handle_valid ? 'Yes' : 'No'}\\n\\n`;\n"
"          \n"
"          // Add interrupt diagnostics if available\n"
"          if(status.interrupt_diagnostics) {\n"
"            msg += 'INTERRUPT DIAGNOSTICS:\\n';\n"
"            msg += `Powered ON: ${status.interrupt_diagnostics.powered_on ? 'Yes' : 'No'}\\n`;\n"
"            msg += `Disturber Detection: ${status.interrupt_diagnostics.disturber_detection_enabled ? 'Enabled' : 'Disabled'}\\n`;\n"
"            msg += `Noise Level: ${status.interrupt_diagnostics.noise_level}\\n`;\n"
"            msg += `AFE Setting: ${status.interrupt_diagnostics.afe_setting}\\n`;\n"
"          }\n"
"          \n"
"          // Add register values if available\n"
"          if(status.registers) {\n"
"            msg += '\\nREGISTER VALUES:\\n';\n"
"            msg += `R0: ${status.registers.r0}\\n`;\n"
"            msg += `R1: ${status.registers.r1}\\n`;\n"
"            msg += `R3: ${status.registers.r3}\\n`;\n"
"            msg += `R8: ${status.registers.r8}`;\n"
"          }\n"
"        } else {\n"
"          msg += '‚úó Sensor Status: NOT INITIALIZED\\n\\n';\n"
"          msg += 'The sensor has not been initialized yet.\\n';\n"
"          msg += 'Please configure the pin settings and save.';\n"
"        }\n"
"        alert(msg);\n"
"      } else {\n"
"        alert('Unable to fetch AS3935 status');\n"
"      }\n"
"    });\n"
"    \n"
"    const as3935_refresh = safeId('as3935_refresh');\n"
"    if(as3935_refresh) as3935_refresh.addEventListener('click', updateAs3935Status);\n"
"\n"
"    // AS3935 Register Handlers\n"
"    async function loadAllRegisters(){\n"
"      const regs = await jsonReq('/api/as3935/registers/all');\n"
"      if(!regs || regs.registers) {\n"
"        const container = safeId('as3935_registers_container');\n"
"        if(!container) return;\n"
"        container.innerHTML = '';\n"
"        \n"
"        // Register descriptions\n"
"        const regDescriptions = {\n"
"          '0x00': {name: 'AFE Gain', desc: 'Receiver gain control'},\n"
"          '0x01': {name: 'Threshold', desc: 'Lightning detection threshold'},\n"
"          '0x02': {name: 'Config', desc: 'General configuration'},\n"
"          '0x03': {name: 'Status', desc: 'Lightning event status (read-only)'},\n"
"          '0x04': {name: 'L.Eng MSB', desc: 'Lightning energy - MSB'},\n"
"          '0x05': {name: 'L.Eng MID', desc: 'Lightning energy - Middle'},\n"
"          '0x06': {name: 'L.Eng LSB', desc: 'Lightning energy - LSB'},\n"
"          '0x07': {name: 'Calibration', desc: 'RLC calibration'},\n"
"          '0x08': {name: 'Distance', desc: 'Lightning distance (km)'}\n"
"        };\n"
"        \n"
"        // Create a card for each register\n"
"        Object.entries(regs.registers || {}).forEach(([reg, val]) => {\n"
"          const desc = regDescriptions[reg] || {name: reg, desc: ''};\n"
"          const isReadOnly = ['0x03', '0x04', '0x05', '0x06', '0x08'].includes(reg);\n"
"          \n"
"          const card = document.createElement('div');\n"
"          card.style.cssText = 'background:#f9f9f9;padding:10px;border-radius:8px;border-left:3px solid #0d47a1';\n"
"          card.innerHTML = `\n"
"            <div class=\"label\" style=\"margin-bottom:4px\"><strong>${desc.name}</strong></div>\n"
"            <div style=\"font-size:12px;color:#666;margin-bottom:8px\">${desc.desc}</div>\n"
"            <div style=\"background:white;padding:6px;border-radius:4px;font-family:monospace;font-size:13px;margin-bottom:8px\">\n"
"              <strong>Current:</strong> ${val} \n"
"            </div>\n"
"            ${!isReadOnly ? `\n"
"              <input type=\"text\" class=\"as3935_reg_input\" data-reg=\"${reg}\" placeholder=\"Hex: 0xFF or Dec: 255\" style=\"font-size:12px;margin-bottom:6px;padding:6px\">\n"
"              <button class=\"as3935_reg_write_btn ghost\" data-reg=\"${reg}\" style=\"width:100%;padding:6px;font-size:12px\">Write</button>\n"
"            ` : `<div style=\"font-size:11px;color:#999;font-style:italic\">Read-only register</div>`}\n"
"          `;\n"
"          container.appendChild(card);\n"
"        });\n"
"        \n"
"        // Add event listeners to write buttons\n"
"        document.querySelectorAll('.as3935_reg_write_btn').forEach(btn => {\n"
"          btn.addEventListener('click', async (e) => {\n"
"            const reg = e.target.dataset.reg;\n"
"            const input = document.querySelector(`.as3935_reg_input[data-reg=\"${reg}\"]`);\n"
"            const val_str = input?.value?.trim();\n"
"            \n"
"            if(!val_str) {\n"
"              alert('‚ö†Ô∏è Please enter a value');\n"
"              return;\n"
"            }\n"
"            \n"
"            let value = parseInt(val_str, 0);  // Auto-detect hex/dec\n"
"            if(isNaN(value) || value < 0 || value > 255) {\n"
"              alert('‚ö†Ô∏è Value must be 0-255 (or 0x00-0xFF in hex)');\n"
"              return;\n"
"            }\n"
"            \n"
"            const result = await fetch('/api/as3935/register/write', {\n"
"              method: 'POST',\n"
"              headers: {'Content-Type': 'application/json'},\n"
"              body: JSON.stringify({reg: parseInt(reg, 16), value})\n"
"            });\n"
"            \n"
"            if(result.ok) {\n"
"              const data = await result.json();\n"
"              alert(`‚úì Register ${reg} written: ${data.value}`);\n"
"              await loadAllRegisters();  // Refresh display\n"
"            } else {\n"
"              alert('‚úó Failed to write register');\n"
"            }\n"
"          });\n"
"        });\n"
"      } else {\n"
"        alert('‚úó Failed to load registers');\n"
"      }\n"
"    }\n"
"\n"
"    const as3935_load_all_regs = safeId('as3935_load_all_regs');\n"
"    if(as3935_load_all_regs) as3935_load_all_regs.addEventListener('click', loadAllRegisters);\n"
"\n"
"    const as3935_load_defaults = safeId('as3935_load_defaults');\n"
"    if(as3935_load_defaults) as3935_load_defaults.addEventListener('click', async ()=>{\n"
"      if(!confirm('‚ö†Ô∏è Load AS3935 default settings?')) return;\n"
"      // This would require a separate endpoint to load defaults\n"
"      alert('Note: To load defaults, reconfigure the sensor with default values in the I2C Configuration section.');\n"
"    });\n"
"\n"
"    const as3935_custom_write = safeId('as3935_custom_write');\n"
"    if(as3935_custom_write) as3935_custom_write.addEventListener('click', async ()=>{\n"
"      const reg_str = (safeId('as3935_custom_reg')?.value || '').trim();\n"
"      const val_str = (safeId('as3935_custom_val')?.value || '').trim();\n"
"      \n"
"      if(!reg_str || !val_str) {\n"
"        alert('‚ö†Ô∏è Please enter both register address and value');\n"
"        return;\n"
"      }\n"
"      \n"
"      let reg = parseInt(reg_str, 0);\n"
"      let value = parseInt(val_str, 0);\n"
"      \n"
"      if(isNaN(reg) || reg < 0 || reg > 255 || isNaN(value) || value < 0 || value > 255) {\n"
"        alert('‚ö†Ô∏è Invalid input. Use 0-255 or hex format (0x00-0xFF)');\n"
"        return;\n"
"      }\n"
"      \n"
"      const result = await fetch('/api/as3935/register/write', {\n"
"        method: 'POST',\n"
"        headers: {'Content-Type': 'application/json'},\n"
"        body: JSON.stringify({reg, value})\n"
"      });\n"
"      \n"
"      if(result.ok) {\n"
"        const data = await result.json();\n"
"        alert(`‚úì Register 0x${reg.toString(16).toUpperCase().padStart(2,'0')} = ${data.value}`);\n"
"        const regField = safeId('as3935_custom_reg');\n"
"        const valField = safeId('as3935_custom_val');\n"
"        if(regField) regField.value = '0x00';\n"
"        if(valField) valField.value = '0x00';\n"
"        await updateAs3935Status();\n"
"      } else {\n"
"        const data = await result.json();\n"
"        alert('‚úó Failed to write register: ' + (data.error || 'Unknown error'));\n"
"      }\n"
"    });  // Advanced Settings Functions\n"
"\n"
"  async function applySetting(endpoint, fieldName, value) {\n"
"    try {\n"
"      const payload = {};\n"
"      payload[fieldName] = value;\n"
"      \n"
"      const result = await fetch(endpoint, {\n"
"        method: 'POST',\n"
"        headers: {'Content-Type': 'application/json'},\n"
"        body: JSON.stringify(payload)\n"
"      });\n"
"      if(result.ok) {\n"
"        const data = await result.json();\n"
"        return true;\n"
"      } else {\n"
"        const data = await result.json();\n"
"        console.error('Failed to update setting:', data);\n"
"        return false;\n"
"      }\n"
"    } catch(e) {\n"
"      console.error('Error updating setting:', e);\n"
"      return false;\n"
"    }\n"
"  }\n"
"\n"
"    // Close modal when clicking outside the content\n"
"    const settings_info_modal = safeId('settings_info_modal');\n"
"    if(settings_info_modal) settings_info_modal.addEventListener('click', (e) => {\n"
"      if(e.target.id === 'settings_info_modal') {\n"
"        e.target.style.display = 'none';\n"
"      }\n"
"    });\n"
"\n"
"    // Advanced Settings Event Listeners\n"
"    const as3935_apply_settings = safeId('as3935_apply_settings');\n"
"    if(as3935_apply_settings) as3935_apply_settings.addEventListener('click', async () => {\n"
"      const afe = safeId('as3935_afe')?.value;\n"
"      const noise = safeId('as3935_noise_level')?.value;\n"
"      const spike = safeId('as3935_spike_rejection')?.value;\n"
"      const strikes = safeId('as3935_min_strikes')?.value;\n"
"      const watchdog = safeId('as3935_watchdog')?.value;\n"
"      const disturberBtn = safeId('as3935_disturber_on');\n"
"      const disturber = disturberBtn?.classList.contains('btn-active') || false;\n"
"\n"
"      let hasError = false;\n"
"\n"
"      if(afe && afe !== '') {\n"
"        if(!await applySetting('/api/as3935/settings/afe', 'afe', parseInt(afe))) {\n"
"          hasError = true;\n"
"        }\n"
"      } else {\n"
"        alert('Please select an Environment Mode');\n"
"        return;\n"
"      }\n"
"\n"
"      if(noise && noise !== '') {\n"
"        if(!await applySetting('/api/as3935/settings/noise-level', 'noise_level', parseInt(noise))) {\n"
"          hasError = true;\n"
"        }\n"
"      } else {\n"
"        alert('Please select a Noise Level');\n"
"        return;\n"
"      }\n"
"\n"
"      if(spike && spike !== '') {\n"
"        if(!await applySetting('/api/as3935/settings/spike-rejection', 'spike_rejection', parseInt(spike))) {\n"
"          hasError = true;\n"
"        }\n"
"      } else {\n"
"        alert('Please enter Spike Rejection value (0-15)');\n"
"        return;\n"
"      }\n"
"\n"
"      if(strikes && strikes !== '') {\n"
"        if(!await applySetting('/api/as3935/settings/min-strikes', 'min_strikes', parseInt(strikes))) {\n"
"          hasError = true;\n"
"        }\n"
"      } else {\n"
"        alert('Please select Min Lightning Strikes');\n"
"        return;\n"
"      }\n"
"\n"
"      if(watchdog && watchdog !== '') {\n"
"        if(!await applySetting('/api/as3935/settings/watchdog', 'watchdog', parseInt(watchdog))) {\n"
"          hasError = true;\n"
"        }\n"
"      } else {\n"
"        alert('Please enter Watchdog Threshold value (0-10)');\n"
"        return;\n"
"      }\n"
"\n"
"      if(!await applySetting('/api/as3935/settings/disturber', 'disturber_enabled', disturber)) {\n"
"        hasError = true;\n"
"      }\n"
"\n"
"      if(!hasError) {\n"
"        alert('‚úì All settings updated successfully!');\n"
"        await loadSettings();\n"
"      } else {\n"
"        alert('‚ö† Some settings failed to update. Check the console for details.');\n"
"      }\n"
"    });\n"
"\n"
"    const system_reboot = safeId('system_reboot');\n"
"    if(system_reboot) system_reboot.addEventListener('click', () => {\n"
"      if(confirm('Are you sure you want to reboot the device? The web interface will disconnect.')) {\n"
"        fetch('/api/system/reboot', {method: 'POST'})\n"
"          .then(() => {\n"
"            alert('Device is rebooting...');\n"
"            setTimeout(() => {\n"
"              window.location.reload();\n"
"            }, 3000);\n"
"          })\n"
"          .catch(e => alert('Reboot request failed: ' + e.message));\n"
"      }\n"
"    });\n"
"\n"
"    const as3935_disturber_on = safeId('as3935_disturber_on');\n"
"    if(as3935_disturber_on) as3935_disturber_on.addEventListener('click', () => {\n"
"      as3935_disturber_on.classList.add('btn-active');\n"
"      as3935_disturber_on.classList.remove('btn-secondary');\n"
"      const as3935_disturber_off = safeId('as3935_disturber_off');\n"
"      if(as3935_disturber_off) {\n"
"        as3935_disturber_off.classList.remove('btn-active');\n"
"        as3935_disturber_off.classList.add('btn-secondary');\n"
"      }\n"
"    });\n"
"\n"
"    const as3935_disturber_off = safeId('as3935_disturber_off');\n"
"    if(as3935_disturber_off) as3935_disturber_off.addEventListener('click', () => {\n"
"      as3935_disturber_off.classList.add('btn-active');\n"
"      as3935_disturber_off.classList.remove('btn-secondary');\n"
"      const as3935_disturber_on = safeId('as3935_disturber_on');\n"
"      if(as3935_disturber_on) {\n"
"        as3935_disturber_on.classList.remove('btn-active');\n"
"        as3935_disturber_on.classList.add('btn-secondary');\n"
"      }\n"
"    });\n"
"\n"
"    // Load settings on page load\n"
"    window.addEventListener('load', loadSettings);\n"
"\n"
"    const as3935_save_all_regs = safeId('as3935_save_all_regs');\n"
"    if(as3935_save_all_regs) as3935_save_all_regs.addEventListener('click', async ()=>{\n"
"      const regs = await jsonReq('/api/as3935/registers/all');\n"
"      if(regs && regs.registers) {\n"
"        const json = JSON.stringify(regs.registers);\n"
"        const result = await fetch('/api/as3935/config/save', {\n"
"          method: 'POST',\n"
"          headers: {'Content-Type': 'application/json'},\n"
"          body: JSON.stringify({config: json})\n"
"        });\n"
"        if(result.ok) {\n"
"          alert('‚úì Current register configuration saved to NVS!');\n"
"        } else {\n"
"          alert('‚úó Failed to save configuration');\n"
"        }\n"
"      }\n"
"    });\n"
"    } catch(e) {\n"
"      console.error('Error registering event listeners:', e);\n"
"    }\n"
"  }\n"
"  \n"
"  document.addEventListener('DOMContentLoaded', load);\n"
"})();\n"
"</script>\n"
"</body>\n"
"</html>\n"
"";

const size_t index_html_len = sizeof(index_html) - 1;

#endif // WEB_INDEX_H
